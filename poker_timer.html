<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Poker Tournament Timer</title>
    <style>
        /* ===============================
           CSS VARIABLES & THEMES
           =============================== */
        :root {
            /* Timing */
            --transition-fast: 0.15s cubic-bezier(0.4, 0, 0.2, 1);
            --transition-normal: 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            --transition-slow: 0.5s cubic-bezier(0.4, 0, 0.2, 1);
            --transition-spring: 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);

            /* Glass effects */
            --glass-blur: 12px;
            --glass-bg: rgba(13, 27, 42, 0.75);
            --glass-border: rgba(255, 255, 255, 0.1);

            /* Default theme (Casino Green) */
            --bg-gradient-1: #1a1a2e;
            --bg-gradient-2: #16213e;
            --bg-gradient-3: #0f3460;
            --card-bg-1: #0d1b2a;
            --card-bg-2: #1b2838;
            --accent-primary: #4ecca3;
            --accent-secondary: #c9a227;
            --accent-danger: #e74c3c;
            --accent-info: #3498db;
            --border-color: #2d5a3d;
            --text-primary: #ffffff;
            --text-secondary: #888888;
            --glow-primary: rgba(78, 204, 163, 0.4);
            --glow-secondary: rgba(201, 162, 39, 0.4);
        }

        /* Midnight Blue Theme */
        [data-theme="midnight"] {
            --bg-gradient-1: #0a0a1a;
            --bg-gradient-2: #1a1a3e;
            --bg-gradient-3: #2a2a5e;
            --card-bg-1: #12122a;
            --card-bg-2: #1e1e3a;
            --accent-primary: #6c5ce7;
            --accent-secondary: #fd79a8;
            --border-color: #3d3d6d;
            --glow-primary: rgba(108, 92, 231, 0.4);
            --glow-secondary: rgba(253, 121, 168, 0.4);
        }

        /* Royal Purple Theme */
        [data-theme="royal"] {
            --bg-gradient-1: #1a0a2e;
            --bg-gradient-2: #2d1b4e;
            --bg-gradient-3: #4a2c6e;
            --card-bg-1: #1f0f35;
            --card-bg-2: #2a1a45;
            --accent-primary: #e056fd;
            --accent-secondary: #f9ca24;
            --border-color: #5a3d7a;
            --glow-primary: rgba(224, 86, 253, 0.4);
            --glow-secondary: rgba(249, 202, 36, 0.4);
        }

        /* Crimson Red Theme */
        [data-theme="crimson"] {
            --bg-gradient-1: #1a0a0a;
            --bg-gradient-2: #2e1515;
            --bg-gradient-3: #4a2020;
            --card-bg-1: #200f0f;
            --card-bg-2: #2a1a1a;
            --accent-primary: #ff6b6b;
            --accent-secondary: #feca57;
            --border-color: #5a2d2d;
            --glow-primary: rgba(255, 107, 107, 0.4);
            --glow-secondary: rgba(254, 202, 87, 0.4);
        }

        /* Ocean Blue Theme */
        [data-theme="ocean"] {
            --bg-gradient-1: #0a1a2a;
            --bg-gradient-2: #0d2840;
            --bg-gradient-3: #103855;
            --card-bg-1: #0c1f30;
            --card-bg-2: #142a3d;
            --accent-primary: #00d2d3;
            --accent-secondary: #54a0ff;
            --border-color: #2a4a5a;
            --glow-primary: rgba(0, 210, 211, 0.4);
            --glow-secondary: rgba(84, 160, 255, 0.4);
        }

        /* Dark Minimal Theme */
        [data-theme="minimal"] {
            --bg-gradient-1: #0d0d0d;
            --bg-gradient-2: #1a1a1a;
            --bg-gradient-3: #252525;
            --card-bg-1: #141414;
            --card-bg-2: #1e1e1e;
            --accent-primary: #ffffff;
            --accent-secondary: #888888;
            --border-color: #333333;
            --glow-primary: rgba(255, 255, 255, 0.2);
            --glow-secondary: rgba(136, 136, 136, 0.3);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, var(--bg-gradient-1) 0%, var(--bg-gradient-2) 50%, var(--bg-gradient-3) 100%);
            min-height: 100vh;
            color: var(--text-primary);
            transition: background var(--transition-slow);
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            text-align: center;
            padding: 15px 0;
            border-bottom: 2px solid var(--accent-secondary);
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 10px;
            animation: fadeInDown 0.6s ease-out;
        }

        header h1 {
            font-size: 2rem;
            color: var(--accent-secondary);
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
            letter-spacing: 3px;
            transition: color var(--transition-normal);
        }

        .header-controls {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .icon-btn {
            background: rgba(201, 162, 39, 0.15);
            backdrop-filter: blur(var(--glass-blur));
            -webkit-backdrop-filter: blur(var(--glass-blur));
            border: 1px solid var(--accent-secondary);
            color: var(--accent-secondary);
            padding: 8px 12px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 1rem;
            transition: all var(--transition-normal), transform var(--transition-fast);
        }

        .icon-btn:hover {
            background: rgba(201, 162, 39, 0.3);
            transform: translateY(-2px);
            box-shadow: 0 4px 15px var(--glow-secondary);
        }

        .icon-btn:active {
            transform: translateY(0) scale(0.95);
        }

        .icon-btn.active {
            background: var(--accent-secondary);
            color: var(--bg-gradient-1);
            box-shadow: 0 0 20px var(--glow-secondary);
        }

        .icon-btn.muted {
            background: rgba(231, 76, 60, 0.15);
            border-color: var(--accent-danger);
            color: var(--accent-danger);
        }

        /* Main Display */
        .main-display {
            display: grid;
            grid-template-columns: 1fr 300px;
            gap: 20px;
        }

        @media (max-width: 1024px) {
            .main-display {
                grid-template-columns: 1fr;
            }
        }

        .timer-display {
            background: linear-gradient(145deg, var(--card-bg-1), var(--card-bg-2));
            backdrop-filter: blur(var(--glass-blur));
            -webkit-backdrop-filter: blur(var(--glass-blur));
            border: 2px solid var(--border-color);
            border-radius: 24px;
            padding: 30px;
            text-align: center;
            box-shadow: 0 10px 40px rgba(0,0,0,0.4),
                        inset 0 0 60px rgba(78, 204, 163, 0.05),
                        0 0 0 1px var(--glass-border);
            animation: fadeInUp 0.6s ease-out;
            transition: all var(--transition-normal);
        }

        .timer-display.presentation-mode {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            z-index: 3000;
            border-radius: 0;
            display: flex;
            flex-direction: column;
            justify-content: center;
            padding: 50px;
        }

        .level-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .level-number {
            font-size: 1.3rem;
            color: var(--accent-secondary);
            transition: color var(--transition-normal);
        }

        .level-number span {
            font-size: 2rem;
            font-weight: bold;
            transition: transform var(--transition-spring);
            display: inline-block;
        }

        .status-badges {
            display: flex;
            gap: 10px;
        }

        .badge {
            padding: 6px 16px;
            border-radius: 20px;
            font-weight: bold;
            font-size: 0.8rem;
            letter-spacing: 0.5px;
            display: none;
            box-shadow: 0 2px 8px rgba(0,0,0,0.3);
        }

        .badge.active {
            display: inline-block;
            animation: badgeIn 0.3s ease-out;
        }

        @keyframes badgeIn {
            from {
                opacity: 0;
                transform: scale(0.8) translateY(-5px);
            }
            to {
                opacity: 1;
                transform: scale(1) translateY(0);
            }
        }

        .break-badge {
            background: linear-gradient(135deg, #c9a227, #a68520);
            color: #1a1a2e;
        }

        .break-badge.active {
            animation: badgeIn 0.3s ease-out, badgePulse 2s ease-in-out 0.3s infinite;
        }

        .rebuy-badge {
            background: linear-gradient(135deg, #3498db, #2980b9);
            color: #fff;
        }

        .hand-for-hand-badge {
            background: linear-gradient(135deg, #e74c3c, #c0392b);
            color: #fff;
        }

        .hand-for-hand-badge.active {
            animation: badgeIn 0.3s ease-out, badgePulse 1.2s ease-in-out 0.3s infinite;
        }

        .bubble-badge {
            background: linear-gradient(135deg, #9b59b6, #8e44ad);
            color: #fff;
        }

        @keyframes badgePulse {
            0%, 100% {
                transform: scale(1);
                box-shadow: 0 2px 8px rgba(0,0,0,0.3);
            }
            50% {
                transform: scale(1.05);
                box-shadow: 0 4px 15px rgba(0,0,0,0.4);
            }
        }

        .blinds-display {
            margin: 20px 0;
        }

        .blinds-display h2 {
            font-size: 3.5rem;
            color: var(--accent-primary);
            text-shadow: 0 0 30px var(--glow-primary);
            margin-bottom: 5px;
            transition: all var(--transition-normal);
        }

        .presentation-mode .blinds-display h2 {
            font-size: 6rem;
        }

        .blinds-label {
            font-size: 1rem;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 2px;
            transition: color var(--transition-normal);
        }

        .ante-display {
            font-size: 1.5rem;
            color: var(--accent-secondary);
            margin-top: 10px;
            transition: all var(--transition-normal);
        }

        .presentation-mode .ante-display {
            font-size: 2.5rem;
        }

        .countdown {
            font-size: 6rem;
            font-weight: bold;
            font-family: 'Courier New', monospace;
            color: var(--text-primary);
            text-shadow: 0 0 30px rgba(255,255,255,0.2);
            margin: 20px 0;
            letter-spacing: 5px;
            transition: color var(--transition-normal), text-shadow var(--transition-normal);
        }

        .presentation-mode .countdown {
            font-size: 12rem;
        }

        .countdown.warning {
            color: #f39c12;
            text-shadow: 0 0 40px rgba(243, 156, 18, 0.5);
            animation: countdownPulse 1s ease-in-out infinite;
        }

        .countdown.danger {
            color: var(--accent-danger);
            text-shadow: 0 0 50px rgba(231, 76, 60, 0.6);
            animation: countdownPulse 0.5s ease-in-out infinite;
        }

        @keyframes countdownPulse {
            0%, 100% {
                opacity: 1;
                transform: scale(1);
            }
            50% {
                opacity: 0.85;
                transform: scale(1.02);
            }
        }

        .next-level {
            background: rgba(201, 162, 39, 0.08);
            backdrop-filter: blur(8px);
            -webkit-backdrop-filter: blur(8px);
            border: 1px solid var(--accent-secondary);
            border-radius: 12px;
            padding: 12px 25px;
            display: inline-block;
            transition: all var(--transition-normal);
        }

        .next-level:hover {
            background: rgba(201, 162, 39, 0.15);
            transform: translateY(-2px);
        }

        .next-level span {
            color: var(--text-secondary);
            font-size: 0.85rem;
            transition: color var(--transition-normal);
        }

        .next-level strong {
            color: var(--accent-secondary);
            font-size: 1.2rem;
            margin-left: 10px;
            transition: color var(--transition-normal);
        }

        .presentation-mode .next-level {
            font-size: 1.5rem;
            padding: 20px 40px;
        }

        .presentation-mode .next-level strong {
            font-size: 2rem;
        }

        /* Controls */
        .controls {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin: 20px 0;
            flex-wrap: wrap;
        }

        .btn {
            padding: 12px 30px;
            font-size: 1rem;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            transition: all var(--transition-normal), transform var(--transition-fast);
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 1px;
            position: relative;
            overflow: hidden;
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.5s ease;
        }

        .btn:hover::before {
            left: 100%;
        }

        .btn:active {
            transform: translateY(0) scale(0.98);
        }

        .btn-primary {
            background: linear-gradient(145deg, #4ecca3, #2d8a6e);
            color: var(--bg-gradient-1);
        }

        [data-theme="midnight"] .btn-primary { background: linear-gradient(145deg, #6c5ce7, #4a3fa0); }
        [data-theme="royal"] .btn-primary { background: linear-gradient(145deg, #e056fd, #9c3cb1); }
        [data-theme="crimson"] .btn-primary { background: linear-gradient(145deg, #ff6b6b, #b34a4a); }
        [data-theme="ocean"] .btn-primary { background: linear-gradient(145deg, #00d2d3, #009394); }
        [data-theme="minimal"] .btn-primary { background: linear-gradient(145deg, #ffffff, #b3b3b3); }

        .btn-primary:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px var(--glow-primary);
        }

        .btn-secondary {
            background: linear-gradient(145deg, #c9a227, #8a6f1a);
            color: var(--bg-gradient-1);
        }

        [data-theme="midnight"] .btn-secondary { background: linear-gradient(145deg, #fd79a8, #b15475); }
        [data-theme="royal"] .btn-secondary { background: linear-gradient(145deg, #f9ca24, #ae8d19); }
        [data-theme="crimson"] .btn-secondary { background: linear-gradient(145deg, #feca57, #b18d3d); }
        [data-theme="ocean"] .btn-secondary { background: linear-gradient(145deg, #54a0ff, #3a70b3); }
        [data-theme="minimal"] .btn-secondary { background: linear-gradient(145deg, #888888, #5f5f5f); }

        .btn-secondary:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px var(--glow-secondary);
        }

        .btn-danger {
            background: linear-gradient(145deg, #e74c3c, #a1352a);
            color: #fff;
        }

        .btn-danger:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(231, 76, 60, 0.4);
        }

        .btn-nav {
            background: linear-gradient(145deg, var(--card-bg-2), var(--card-bg-1));
            color: var(--text-primary);
            padding: 10px 20px;
            border: 1px solid var(--border-color);
        }

        .btn-nav:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            border-color: var(--accent-primary);
        }

        .btn-small {
            padding: 8px 15px;
            font-size: 0.85rem;
        }

        /* Side Panel */
        .side-panel {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .panel-card {
            background: linear-gradient(145deg, var(--card-bg-1), var(--card-bg-2));
            backdrop-filter: blur(var(--glass-blur));
            -webkit-backdrop-filter: blur(var(--glass-blur));
            border: 1px solid var(--border-color);
            border-radius: 16px;
            padding: 18px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.2),
                        0 0 0 1px var(--glass-border);
            transition: all var(--transition-normal);
            animation: fadeInRight 0.5s ease-out backwards;
        }

        .panel-card:nth-child(1) { animation-delay: 0.1s; }
        .panel-card:nth-child(2) { animation-delay: 0.2s; }
        .panel-card:nth-child(3) { animation-delay: 0.3s; }
        .panel-card:nth-child(4) { animation-delay: 0.4s; }
        .panel-card:nth-child(5) { animation-delay: 0.5s; }

        .panel-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 30px rgba(0,0,0,0.3),
                        0 0 0 1px var(--accent-primary);
        }

        .panel-card h4 {
            color: var(--accent-secondary);
            margin-bottom: 12px;
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            border-bottom: 1px solid var(--border-color);
            padding-bottom: 8px;
            transition: color var(--transition-normal);
        }

        /* Tournament Stats */
        .stats-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }

        .stat-item {
            text-align: center;
            padding: 10px;
            background: rgba(78, 204, 163, 0.08);
            border-radius: 10px;
            transition: all var(--transition-normal);
            border: 1px solid transparent;
        }

        .stat-item:hover {
            background: rgba(78, 204, 163, 0.15);
            border-color: var(--border-color);
        }

        .stat-value {
            font-size: 1.4rem;
            color: var(--accent-primary);
            font-weight: bold;
            transition: all var(--transition-normal);
        }

        .stat-label {
            font-size: 0.7rem;
            color: var(--text-secondary);
            text-transform: uppercase;
            transition: color var(--transition-normal);
        }

        /* Prize Pool */
        .prize-list {
            font-size: 0.85rem;
        }

        .prize-item {
            display: flex;
            justify-content: space-between;
            padding: 8px 5px;
            border-bottom: 1px solid rgba(78, 204, 163, 0.15);
            transition: all var(--transition-fast);
            border-radius: 4px;
        }

        .prize-item:hover {
            background: rgba(78, 204, 163, 0.08);
            padding-left: 10px;
        }

        .prize-item:last-child {
            border-bottom: none;
        }

        .prize-place {
            color: var(--accent-secondary);
            transition: color var(--transition-normal);
        }

        .prize-amount {
            color: var(--accent-primary);
            font-weight: 600;
            transition: color var(--transition-normal);
        }

        /* Chip Colors */
        .chip-legend {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }

        .chip {
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 0.8rem;
            padding: 5px 10px;
            background: rgba(0,0,0,0.25);
            border-radius: 20px;
            transition: all var(--transition-normal);
            border: 1px solid transparent;
        }

        .chip:hover {
            background: rgba(0,0,0,0.4);
            transform: scale(1.05);
            border-color: var(--border-color);
        }

        .chip-color {
            width: 18px;
            height: 18px;
            border-radius: 50%;
            border: 2px dashed rgba(255,255,255,0.5);
            transition: transform var(--transition-fast);
        }

        .chip:hover .chip-color {
            transform: rotate(180deg);
        }

        /* Chip Settings Editor */
        .chip-settings-list {
            display: flex;
            flex-direction: column;
            gap: 8px;
            max-height: 250px;
            overflow-y: auto;
        }

        .chip-setting-row {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 8px;
            background: rgba(0,0,0,0.2);
            border-radius: 8px;
        }

        .chip-setting-row input[type="number"] {
            width: 90px;
            padding: 6px 8px;
            background: rgba(255,255,255,0.1);
            border: 1px solid var(--border-color);
            border-radius: 4px;
            color: var(--text-primary);
            font-size: 0.9rem;
        }

        .chip-setting-row input[type="text"] {
            width: 80px;
            padding: 6px 8px;
            background: rgba(255,255,255,0.1);
            border: 1px solid var(--border-color);
            border-radius: 4px;
            color: var(--text-primary);
            font-size: 0.9rem;
        }

        .chip-setting-row input[type="color"] {
            width: 36px;
            height: 36px;
            padding: 0;
            border: none;
            border-radius: 50%;
            cursor: pointer;
            background: transparent;
        }

        .chip-setting-row input[type="color"]::-webkit-color-swatch-wrapper {
            padding: 2px;
        }

        .chip-setting-row input[type="color"]::-webkit-color-swatch {
            border-radius: 50%;
            border: 2px solid rgba(255,255,255,0.3);
        }

        .chip-setting-row label {
            font-size: 0.75rem;
            color: var(--text-secondary);
            min-width: 40px;
        }

        .chip-remove-btn {
            background: rgba(231, 76, 60, 0.3);
            border: none;
            color: #e74c3c;
            width: 28px;
            height: 28px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 1rem;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-left: auto;
            transition: all var(--transition-fast);
        }

        .chip-remove-btn:hover {
            background: rgba(231, 76, 60, 0.5);
        }

        .chip-setting-row input[type="checkbox"] {
            width: 18px;
            height: 18px;
            cursor: pointer;
            accent-color: var(--accent-primary);
        }

        .chip-setting-row.inactive {
            opacity: 0.5;
        }

        .chip-setting-row.inactive input:not([type="checkbox"]) {
            opacity: 0.6;
        }

        /* Player Controls */
        .player-controls {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
            margin-bottom: 10px;
        }

        .player-btn {
            background: var(--border-color);
            border: none;
            color: var(--text-primary);
            width: 34px;
            height: 34px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 1.2rem;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all var(--transition-normal);
        }

        .player-btn:hover {
            background: var(--accent-primary);
            color: var(--bg-gradient-1);
            transform: scale(1.1);
            box-shadow: 0 4px 15px var(--glow-primary);
        }

        .player-btn:active {
            transform: scale(0.95);
        }

        .player-count {
            font-size: 2rem;
            color: var(--accent-primary);
            min-width: 60px;
            text-align: center;
            transition: all var(--transition-normal);
        }

        /* Tables */
        .tables-info {
            display: flex;
            justify-content: space-around;
            text-align: center;
        }

        .table-stat {
            padding: 8px;
            border-radius: 8px;
            transition: all var(--transition-normal);
        }

        .table-stat:hover {
            background: rgba(78, 204, 163, 0.1);
        }

        .table-stat .value {
            font-size: 1.2rem;
            color: var(--accent-primary);
            transition: color var(--transition-normal);
        }

        .table-stat .label {
            font-size: 0.7rem;
            color: var(--text-secondary);
            transition: color var(--transition-normal);
        }

        /* Time Controls */
        .time-adjust {
            display: flex;
            gap: 6px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .time-btn {
            padding: 6px 12px;
            background: rgba(78, 204, 163, 0.1);
            border: 1px solid var(--border-color);
            color: var(--text-primary);
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.8rem;
            transition: all var(--transition-normal);
        }

        .time-btn:hover {
            background: rgba(78, 204, 163, 0.25);
            border-color: var(--accent-primary);
            transform: translateY(-2px);
        }

        .time-btn:active {
            transform: translateY(0) scale(0.95);
        }

        /* Tabs */
        .tabs {
            display: flex;
            border-bottom: 2px solid var(--border-color);
            margin-bottom: 15px;
            position: relative;
        }

        .tab {
            padding: 12px 24px;
            cursor: pointer;
            color: var(--text-secondary);
            border-bottom: 2px solid transparent;
            margin-bottom: -2px;
            transition: all var(--transition-normal);
            position: relative;
        }

        .tab:hover {
            color: var(--text-primary);
            background: rgba(78, 204, 163, 0.05);
        }

        .tab.active {
            color: var(--accent-secondary);
            border-bottom-color: var(--accent-secondary);
        }

        .tab-content {
            display: none;
            animation: fadeIn 0.3s ease-out;
        }

        .tab-content.active {
            display: block;
        }

        /* Structure Table */
        .structure-panel {
            background: linear-gradient(145deg, var(--card-bg-1), var(--card-bg-2));
            backdrop-filter: blur(var(--glass-blur));
            -webkit-backdrop-filter: blur(var(--glass-blur));
            border: 1px solid var(--border-color);
            border-radius: 20px;
            padding: 25px;
            margin-top: 20px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.2),
                        0 0 0 1px var(--glass-border);
            animation: fadeInUp 0.6s ease-out 0.2s backwards;
        }

        .structure-panel h3 {
            color: var(--accent-secondary);
            margin-bottom: 15px;
            font-size: 1.2rem;
            transition: color var(--transition-normal);
        }

        .structure-table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 15px;
            font-size: 0.9rem;
        }

        .structure-table th,
        .structure-table td {
            padding: 12px 14px;
            text-align: center;
            border-bottom: 1px solid var(--border-color);
            transition: all var(--transition-fast);
        }

        .structure-table th {
            background: rgba(78, 204, 163, 0.1);
            color: var(--accent-secondary);
            text-transform: uppercase;
            font-size: 0.75rem;
            letter-spacing: 1px;
        }

        .structure-table tr {
            transition: all var(--transition-fast);
        }

        .structure-table tr:hover {
            background: rgba(78, 204, 163, 0.08);
        }

        .structure-table tr.current-level {
            background: rgba(78, 204, 163, 0.15);
            border-left: 3px solid var(--accent-primary);
            box-shadow: inset 0 0 20px rgba(78, 204, 163, 0.1);
        }

        .structure-table tr.break-row {
            background: rgba(201, 162, 39, 0.08);
            color: var(--accent-secondary);
            font-style: italic;
        }

        .structure-table input {
            width: 70px;
            padding: 8px;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            background: var(--bg-gradient-1);
            color: var(--text-primary);
            text-align: center;
            font-size: 0.85rem;
            transition: all var(--transition-normal);
        }

        .structure-table input:focus {
            outline: none;
            border-color: var(--accent-primary);
            box-shadow: 0 0 0 3px var(--glow-primary);
        }

        .add-level-btn {
            background: transparent;
            border: 2px dashed var(--accent-primary);
            color: var(--accent-primary);
            padding: 10px 18px;
            border-radius: 10px;
            cursor: pointer;
            margin: 3px;
            transition: all var(--transition-normal);
            font-size: 0.85rem;
        }

        .add-level-btn:hover {
            background: rgba(78, 204, 163, 0.15);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px var(--glow-primary);
        }

        .remove-btn {
            background: var(--accent-danger);
            color: #fff;
            border: none;
            padding: 6px 10px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.75rem;
            transition: all var(--transition-fast);
        }

        .remove-btn:hover {
            background: #c0392b;
            transform: scale(1.1);
        }

        /* Settings */
        .settings-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 18px;
        }

        .setting-item {
            display: flex;
            flex-direction: column;
            gap: 6px;
        }

        .setting-item label {
            color: var(--text-secondary);
            font-size: 0.85rem;
            transition: color var(--transition-normal);
        }

        .setting-item input[type="number"],
        .setting-item input[type="text"],
        .setting-item select {
            padding: 10px 12px;
            border: 1px solid var(--border-color);
            border-radius: 10px;
            background: var(--bg-gradient-1);
            color: var(--text-primary);
            transition: all var(--transition-normal);
        }

        .setting-item input[type="number"]:focus,
        .setting-item input[type="text"]:focus,
        .setting-item select:focus {
            outline: none;
            border-color: var(--accent-primary);
            box-shadow: 0 0 0 3px var(--glow-primary);
        }

        .setting-item input[type="checkbox"] {
            width: 20px;
            height: 20px;
            accent-color: var(--accent-primary);
            cursor: pointer;
        }

        .checkbox-item {
            flex-direction: row;
            align-items: center;
            gap: 10px;
        }

        /* Presets */
        .preset-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 15px;
        }

        .preset-btn {
            padding: 10px 18px;
            background: rgba(201, 162, 39, 0.12);
            border: 1px solid var(--accent-secondary);
            color: var(--accent-secondary);
            border-radius: 25px;
            cursor: pointer;
            font-size: 0.85rem;
            transition: all var(--transition-normal);
        }

        .preset-btn:hover {
            background: var(--accent-secondary);
            color: var(--bg-gradient-1);
            transform: translateY(-2px);
            box-shadow: 0 4px 15px var(--glow-secondary);
        }

        .preset-btn:active {
            transform: translateY(0) scale(0.98);
        }

        /* Announcements */
        .announcement {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: linear-gradient(145deg, var(--card-bg-1), var(--card-bg-2));
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            padding: 50px 80px;
            border-radius: 24px;
            border: 2px solid var(--accent-secondary);
            text-align: center;
            z-index: 4000;
            opacity: 0;
            pointer-events: none;
            transition: opacity var(--transition-normal);
            box-shadow: 0 25px 80px rgba(0,0,0,0.5);
        }

        .announcement.active {
            opacity: 1;
            pointer-events: auto;
            animation: popInSpring 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
        }

        @keyframes popInSpring {
            from {
                transform: translate(-50%, -50%) scale(0.7);
                opacity: 0;
            }
            to {
                transform: translate(-50%, -50%) scale(1);
                opacity: 1;
            }
        }

        .announcement h2 {
            font-size: 3rem;
            color: var(--accent-secondary);
            margin-bottom: 20px;
            transition: color var(--transition-normal);
        }

        .announcement p {
            font-size: 1.5rem;
            color: var(--text-primary);
            margin-bottom: 30px;
        }

        /* Modal */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.6);
            backdrop-filter: blur(8px);
            -webkit-backdrop-filter: blur(8px);
            z-index: 5000;
            display: flex;
            justify-content: center;
            align-items: center;
            opacity: 0;
            pointer-events: none;
            transition: opacity var(--transition-normal);
        }

        .modal-overlay.active {
            opacity: 1;
            pointer-events: auto;
        }

        .modal {
            background: linear-gradient(145deg, var(--card-bg-1), var(--card-bg-2));
            backdrop-filter: blur(var(--glass-blur));
            -webkit-backdrop-filter: blur(var(--glass-blur));
            border: 1px solid var(--accent-secondary);
            border-radius: 20px;
            padding: 35px;
            max-width: 600px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            transform: translateY(20px) scale(0.95);
            transition: transform var(--transition-spring);
            box-shadow: 0 25px 60px rgba(0,0,0,0.4);
        }

        .modal-overlay.active .modal {
            transform: translateY(0) scale(1);
        }

        .modal h2 {
            color: var(--accent-secondary);
            margin-bottom: 20px;
            transition: color var(--transition-normal);
        }

        .modal-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 25px;
        }

        /* Keyboard shortcuts */
        .shortcuts-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 10px;
            font-size: 0.85rem;
        }

        .shortcut {
            display: flex;
            gap: 10px;
            align-items: center;
            padding: 6px 8px;
            border-radius: 8px;
            transition: all var(--transition-fast);
        }

        .shortcut:hover {
            background: rgba(78, 204, 163, 0.1);
        }

        .key {
            background: var(--border-color);
            padding: 4px 10px;
            border-radius: 6px;
            font-family: monospace;
            border: 1px solid rgba(255,255,255,0.1);
            transition: all var(--transition-normal);
        }

        .shortcut:hover .key {
            background: var(--accent-primary);
            color: var(--bg-gradient-1);
        }

        /* Responsive */
        @media (max-width: 768px) {
            .countdown {
                font-size: 4rem;
            }

            .blinds-display h2 {
                font-size: 2.5rem;
            }

            .btn {
                padding: 10px 20px;
                font-size: 0.9rem;
            }

            .level-info {
                flex-direction: column;
                gap: 10px;
            }

            header h1 {
                font-size: 1.5rem;
            }
        }

        /* Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: var(--bg-gradient-1);
        }

        ::-webkit-scrollbar-thumb {
            background: var(--border-color);
            border-radius: 4px;
            transition: background var(--transition-normal);
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--accent-primary);
        }

        /* Keyframe Animations */
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes fadeInDown {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes fadeInRight {
            from {
                opacity: 0;
                transform: translateX(20px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        /* Theme Selector */
        .theme-selector {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 10px;
        }

        .theme-btn {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            border: 3px solid transparent;
            cursor: pointer;
            transition: all var(--transition-normal);
            position: relative;
            overflow: hidden;
        }

        .theme-btn:hover {
            transform: scale(1.15);
        }

        .theme-btn.active {
            border-color: var(--text-primary);
            box-shadow: 0 0 15px rgba(255,255,255,0.3);
        }

        .theme-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 50%;
        }

        .theme-btn::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 0;
            right: 0;
            bottom: 0;
        }

        .theme-btn[data-theme="default"] { background: linear-gradient(135deg, #4ecca3 50%, #c9a227 50%); }
        .theme-btn[data-theme="midnight"] { background: linear-gradient(135deg, #6c5ce7 50%, #fd79a8 50%); }
        .theme-btn[data-theme="royal"] { background: linear-gradient(135deg, #e056fd 50%, #f9ca24 50%); }
        .theme-btn[data-theme="crimson"] { background: linear-gradient(135deg, #ff6b6b 50%, #feca57 50%); }
        .theme-btn[data-theme="ocean"] { background: linear-gradient(135deg, #00d2d3 50%, #54a0ff 50%); }
        .theme-btn[data-theme="minimal"] { background: linear-gradient(135deg, #ffffff 50%, #888888 50%); }

        /* Print styles */
        @media print {
            body {
                background: #fff;
                color: #000;
            }

            .timer-display, .panel-card, .structure-panel {
                background: #fff;
                border-color: #000;
            }

            .controls, .header-controls, .icon-btn {
                display: none;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>‚ô† POKER TIMER ‚ô†</h1>
            <div class="header-controls">
                <button class="icon-btn" id="soundToggle" title="Toggle Sound (M)">üîä</button>
                <button class="icon-btn" id="presentationBtn" title="Presentation Mode (P)">üì∫</button>
                <button class="icon-btn" id="fullscreenBtn" title="Fullscreen (F)">‚õ∂</button>
                <button class="icon-btn" id="settingsBtn" title="Settings">‚öôÔ∏è</button>
                <button class="icon-btn" id="helpBtn" title="Keyboard Shortcuts">‚ùì</button>
            </div>
        </header>

        <div class="main-display">
            <div class="timer-display" id="timerDisplay">
                <div class="level-info">
                    <div class="level-number">Level <span id="currentLevel">1</span></div>
                    <div class="status-badges">
                        <span class="badge break-badge" id="breakBadge">BREAK</span>
                        <span class="badge rebuy-badge" id="rebuyBadge">REBUY OPEN</span>
                        <span class="badge hand-for-hand-badge" id="hfhBadge">HAND FOR HAND</span>
                        <span class="badge bubble-badge" id="bubbleBadge">BUBBLE</span>
                    </div>
                </div>

                <div class="blinds-display">
                    <div class="blinds-label">Blinds</div>
                    <h2 id="blindsText">25 / 50</h2>
                    <div class="ante-display" id="anteText"></div>
                </div>

                <div class="countdown" id="countdown">20:00</div>

                <div class="next-level" id="nextLevelInfo">
                    <span>Next:</span>
                    <strong id="nextBlinds">50 / 100</strong>
                </div>

                <div class="controls">
                    <button class="btn btn-nav" onclick="previousLevel()">‚óÄ Prev</button>
                    <button class="btn btn-primary" id="playPauseBtn" onclick="toggleTimer()">START</button>
                    <button class="btn btn-secondary" onclick="resetLevel()">Reset</button>
                    <button class="btn btn-nav" onclick="nextLevel()">Next ‚ñ∂</button>
                </div>

                <div class="time-adjust">
                    <button class="time-btn" onclick="adjustTime(-60)">-1 min</button>
                    <button class="time-btn" onclick="adjustTime(-10)">-10s</button>
                    <button class="time-btn" onclick="adjustTime(10)">+10s</button>
                    <button class="time-btn" onclick="adjustTime(60)">+1 min</button>
                    <button class="time-btn" onclick="adjustTime(300)">+5 min</button>
                </div>

                <button class="btn btn-small btn-nav" style="margin-top: 15px;" onclick="exitPresentation()" id="exitPresentationBtn" hidden>Exit Presentation</button>
            </div>

            <div class="side-panel" id="sidePanel">
                <!-- Tournament Info -->
                <div class="panel-card">
                    <h4>Tournament Info</h4>
                    <div class="stats-grid">
                        <div class="stat-item">
                            <div class="stat-value" id="totalTime">00:00:00</div>
                            <div class="stat-label">Elapsed</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value" id="avgStack">--</div>
                            <div class="stat-label">Avg Stack (BB)</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value" id="mRatio">--</div>
                            <div class="stat-label">M-Ratio</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value" id="levelsRemaining">--</div>
                            <div class="stat-label">Levels Left</div>
                        </div>
                    </div>
                </div>

                <!-- Players -->
                <div class="panel-card">
                    <h4>Players Remaining</h4>
                    <div class="player-controls">
                        <button class="player-btn" onclick="adjustPlayers(-1)">‚àí</button>
                        <div class="player-count" id="playersRemaining">9</div>
                        <button class="player-btn" onclick="adjustPlayers(1)">+</button>
                    </div>
                    <div class="tables-info">
                        <div class="table-stat">
                            <div class="value" id="tablesCount">1</div>
                            <div class="label">Tables</div>
                        </div>
                        <div class="table-stat">
                            <div class="value" id="playersPerTable">9</div>
                            <div class="label">Per Table</div>
                        </div>
                        <div class="table-stat">
                            <div class="value" id="totalChips">90,000</div>
                            <div class="label">Total Chips</div>
                        </div>
                    </div>
                </div>

                <!-- Prize Pool -->
                <div class="panel-card">
                    <h4>Prize Pool</h4>
                    <div class="stat-item" style="margin-bottom: 10px;">
                        <div class="stat-value" id="prizePool">$0</div>
                    </div>
                    <div class="prize-list" id="prizeList">
                        <!-- Generated dynamically -->
                    </div>
                </div>

                <!-- Chip Colors -->
                <div class="panel-card">
                    <h4>Chip Values</h4>
                    <div class="chip-legend" id="chipLegend">
                        <!-- Generated dynamically -->
                    </div>
                </div>

                <!-- Quick Actions -->
                <div class="panel-card">
                    <h4>Quick Actions</h4>
                    <div style="display: flex; flex-direction: column; gap: 8px;">
                        <button class="btn btn-small btn-secondary" onclick="toggleRebuy()">Toggle Rebuy Period</button>
                        <button class="btn btn-small btn-danger" onclick="toggleHandForHand()">Toggle Hand-for-Hand</button>
                        <button class="btn btn-small btn-nav" onclick="toggleBubble()">Toggle Bubble</button>
                        <button class="btn btn-small btn-nav" onclick="randomSeat()">Random Seat Draw</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Structure Panel with Tabs -->
        <div class="structure-panel">
            <div class="tabs">
                <div class="tab active" onclick="switchTab('structure')">Blind Structure</div>
                <div class="tab" onclick="switchTab('settings')">Settings</div>
                <div class="tab" onclick="switchTab('presets')">Presets</div>
            </div>

            <!-- Structure Tab -->
            <div class="tab-content active" id="structureTab">
                <table class="structure-table" id="structureTable">
                    <thead>
                        <tr>
                            <th>Level</th>
                            <th>Small Blind</th>
                            <th>Big Blind</th>
                            <th>Ante</th>
                            <th>Duration</th>
                            <th>Action</th>
                        </tr>
                    </thead>
                    <tbody id="structureBody">
                    </tbody>
                </table>

                <div style="text-align: center;">
                    <button class="add-level-btn" onclick="addLevel()">+ Add Level</button>
                    <button class="add-level-btn" onclick="addBreak()">+ Add Break</button>
                    <button class="add-level-btn" onclick="exportStructure()">üì§ Export</button>
                    <button class="add-level-btn" onclick="importStructure()">üì• Import</button>
                </div>
            </div>

            <!-- Settings Tab -->
            <div class="tab-content" id="settingsTab">
                <div class="settings-grid">
                    <div class="setting-item">
                        <label>Tournament Name</label>
                        <input type="text" id="tournamentName" value="Home Game" onchange="saveSettings()">
                    </div>
                    <div class="setting-item">
                        <label>Default Level Duration (min)</label>
                        <input type="number" id="levelDuration" value="20" min="1" max="120" onchange="updateLevelDuration()">
                    </div>
                    <div class="setting-item">
                        <label>Starting Chips</label>
                        <input type="number" id="startingChips" value="10000" min="100" step="100" onchange="updateStats()">
                    </div>
                    <div class="setting-item">
                        <label>Starting Players</label>
                        <input type="number" id="playerCount" value="9" min="2" max="1000" onchange="updateStats()">
                    </div>
                    <div class="setting-item">
                        <label>Buy-in Amount ($)</label>
                        <input type="number" id="buyIn" value="50" min="0" onchange="updatePrizePool()">
                    </div>
                    <div class="setting-item">
                        <label>Rebuy Amount ($)</label>
                        <input type="number" id="rebuyAmount" value="50" min="0" onchange="updatePrizePool()">
                    </div>
                    <div class="setting-item">
                        <label>Players Per Table</label>
                        <input type="number" id="seatsPerTable" value="9" min="2" max="10" onchange="updateStats()">
                    </div>
                    <div class="setting-item">
                        <label>Rebuy End Level</label>
                        <input type="number" id="rebuyEndLevel" value="6" min="1" onchange="saveSettings()">
                    </div>
                    <div class="setting-item">
                        <label>Warning Time (sec)</label>
                        <input type="number" id="warningTime" value="60" min="10" max="300" onchange="saveSettings()">
                    </div>
                    <div class="setting-item">
                        <label>Danger Time (sec)</label>
                        <input type="number" id="dangerTime" value="10" min="5" max="60" onchange="saveSettings()">
                    </div>
                    <div class="setting-item checkbox-item">
                        <input type="checkbox" id="announceLevels" checked onchange="saveSettings()">
                        <label>Announce Level Changes</label>
                    </div>
                    <div class="setting-item checkbox-item">
                        <input type="checkbox" id="announceBreaks" checked onchange="saveSettings()">
                        <label>Announce Breaks</label>
                    </div>
                    <div class="setting-item checkbox-item">
                        <input type="checkbox" id="playCountdown" checked onchange="saveSettings()">
                        <label>Play Countdown Beeps</label>
                    </div>
                    <div class="setting-item checkbox-item">
                        <input type="checkbox" id="autoAdvance" checked onchange="saveSettings()">
                        <label>Auto-Advance Levels</label>
                    </div>
                </div>

                <h4 style="color: var(--accent-secondary); margin: 20px 0 10px; transition: color var(--transition-normal);">Theme</h4>
                <div class="theme-selector" id="themeSelector">
                    <button class="theme-btn active" data-theme="default" onclick="setTheme('default')" title="Casino Green"></button>
                    <button class="theme-btn" data-theme="midnight" onclick="setTheme('midnight')" title="Midnight Blue"></button>
                    <button class="theme-btn" data-theme="royal" onclick="setTheme('royal')" title="Royal Purple"></button>
                    <button class="theme-btn" data-theme="crimson" onclick="setTheme('crimson')" title="Crimson Red"></button>
                    <button class="theme-btn" data-theme="ocean" onclick="setTheme('ocean')" title="Ocean Blue"></button>
                    <button class="theme-btn" data-theme="minimal" onclick="setTheme('minimal')" title="Dark Minimal"></button>
                </div>

                <h4 style="color: var(--accent-secondary); margin: 20px 0 10px; transition: color var(--transition-normal);">Chip Values & Colors</h4>
                <div class="chip-settings-list" id="chipSettings">
                    <!-- Generated dynamically -->
                </div>
                <div style="display: flex; gap: 10px; margin-top: 10px;">
                    <button class="btn btn-secondary btn-small" onclick="addChip()">+ Add Chip</button>
                    <button class="btn btn-secondary btn-small" onclick="resetChipsToDefault()">Reset to Defaults</button>
                </div>

                <h4 style="color: var(--accent-secondary); margin: 20px 0 10px; transition: color var(--transition-normal);">Payout Structure</h4>
                <div class="settings-grid">
                    <div class="setting-item">
                        <label>1st Place %</label>
                        <input type="number" id="payout1" value="50" min="0" max="100" onchange="updatePrizePool()">
                    </div>
                    <div class="setting-item">
                        <label>2nd Place %</label>
                        <input type="number" id="payout2" value="30" min="0" max="100" onchange="updatePrizePool()">
                    </div>
                    <div class="setting-item">
                        <label>3rd Place %</label>
                        <input type="number" id="payout3" value="20" min="0" max="100" onchange="updatePrizePool()">
                    </div>
                </div>
            </div>

            <!-- Presets Tab -->
            <div class="tab-content" id="presetsTab">
                <h4 style="color: var(--accent-secondary); margin-bottom: 15px; transition: color var(--transition-normal);">Load Tournament Preset</h4>
                <div class="preset-buttons">
                    <button class="preset-btn" onclick="loadPreset('turbo')">üöÄ Turbo (10 min levels)</button>
                    <button class="preset-btn" onclick="loadPreset('standard')">üéØ Standard (20 min levels)</button>
                    <button class="preset-btn" onclick="loadPreset('deepstack')">üí∞ Deep Stack (30 min levels)</button>
                    <button class="preset-btn" onclick="loadPreset('superTurbo')">‚ö° Super Turbo (5 min)</button>
                    <button class="preset-btn" onclick="loadPreset('shootout')">üéØ Shootout</button>
                    <button class="preset-btn" onclick="loadPreset('bounty')">üè¥‚Äç‚ò†Ô∏è Bounty</button>
                </div>

                <h4 style="color: var(--accent-secondary); margin: 20px 0 15px; transition: color var(--transition-normal);">Saved Tournaments</h4>
                <div id="savedTournaments">
                    <!-- Generated dynamically -->
                </div>
                <button class="btn btn-secondary btn-small" style="margin-top: 15px;" onclick="saveTournament()">üíæ Save Current Tournament</button>
            </div>
        </div>
    </div>

    <!-- Announcement Overlay -->
    <div class="announcement" id="announcement">
        <h2 id="announcementTitle">Level Up!</h2>
        <p id="announcementText">New blinds: 50 / 100</p>
        <button class="btn btn-primary" onclick="closeAnnouncement()">Continue</button>
    </div>

    <!-- Settings Modal -->
    <div class="modal-overlay" id="randomSeatModal">
        <div class="modal">
            <h2>üé≤ Random Seat Assignment</h2>
            <p style="font-size: 3rem; color: #4ecca3; margin: 30px 0;" id="randomSeatResult">--</p>
            <p>Table <span id="randomTable">1</span>, Seat <span id="randomSeat">1</span></p>
            <div class="modal-buttons">
                <button class="btn btn-secondary" onclick="randomSeat()">Draw Again</button>
                <button class="btn btn-nav" onclick="closeModal('randomSeatModal')">Close</button>
            </div>
        </div>
    </div>

    <!-- Help Modal -->
    <div class="modal-overlay" id="helpModal">
        <div class="modal">
            <h2>‚å®Ô∏è Keyboard Shortcuts</h2>
            <div class="shortcuts-list">
                <div class="shortcut"><span class="key">Space</span> Play/Pause</div>
                <div class="shortcut"><span class="key">‚Üê</span> Previous Level</div>
                <div class="shortcut"><span class="key">‚Üí</span> Next Level</div>
                <div class="shortcut"><span class="key">R</span> Reset Level</div>
                <div class="shortcut"><span class="key">F</span> Fullscreen</div>
                <div class="shortcut"><span class="key">P</span> Presentation</div>
                <div class="shortcut"><span class="key">M</span> Mute/Unmute</div>
                <div class="shortcut"><span class="key">+</span> Add 1 minute</div>
                <div class="shortcut"><span class="key">-</span> Remove 1 minute</div>
                <div class="shortcut"><span class="key">H</span> Hand-for-Hand</div>
                <div class="shortcut"><span class="key">B</span> Toggle Bubble</div>
                <div class="shortcut"><span class="key">1-9</span> Jump to Level</div>
            </div>
            <div class="modal-buttons">
                <button class="btn btn-nav" onclick="closeModal('helpModal')">Close</button>
            </div>
        </div>
    </div>

    <!-- Import Modal -->
    <div class="modal-overlay" id="importModal">
        <div class="modal">
            <h2>üì• Import Structure</h2>
            <textarea id="importData" style="width: 100%; height: 200px; background: #1a1a2e; color: #fff; border: 1px solid #2d5a3d; border-radius: 5px; padding: 10px; font-family: monospace;" placeholder="Paste JSON structure here..."></textarea>
            <div class="modal-buttons">
                <button class="btn btn-primary" onclick="doImport()">Import</button>
                <button class="btn btn-nav" onclick="closeModal('importModal')">Cancel</button>
            </div>
        </div>
    </div>

    <script>
        // ===============================
        // CONFIGURATION
        // ===============================
        const defaultChips = [
            { value: 25, color: '#ffffff', name: 'White', active: true },
            { value: 100, color: '#3498db', name: 'Blue', active: true },
            { value: 500, color: '#e74c3c', name: 'Red', active: true },
            { value: 1000, color: '#2ecc71', name: 'Green', active: true },
            { value: 2000, color: '#000000', name: 'Black', active: true }
        ];

        // ===============================
        // STATE
        // ===============================
        let structure = [];
        let currentLevelIndex = 0;
        let timeRemaining = 20 * 60;
        let levelDuration = 20 * 60;
        let isRunning = false;
        let timerInterval = null;
        let totalSeconds = 0;
        let totalTimeInterval = null;
        let soundEnabled = true;
        let playersRemaining = 9;
        let rebuys = 0;
        let rebuyOpen = false;
        let handForHand = false;
        let bubbleMode = false;
        let presentationMode = false;
        let chips = defaultChips.map(chip => ({...chip}));
        let audioContext = null;
        let currentTheme = 'default';

        // ===============================
        // THEME
        // ===============================
        function setTheme(theme) {
            currentTheme = theme;
            if (theme === 'default') {
                document.documentElement.removeAttribute('data-theme');
            } else {
                document.documentElement.setAttribute('data-theme', theme);
            }
            // Update active state on theme buttons
            document.querySelectorAll('.theme-btn').forEach(btn => {
                btn.classList.toggle('active', btn.dataset.theme === theme);
            });
            saveState();
        }

        function loadTheme() {
            const saved = localStorage.getItem('pokerTimer');
            if (saved) {
                try {
                    const state = JSON.parse(saved);
                    if (state.theme) {
                        setTheme(state.theme);
                    }
                } catch (e) {}
            }
        }

        // ===============================
        // PRESETS
        // ===============================
        const presets = {
            turbo: {
                name: 'Turbo',
                duration: 10,
                structure: [
                    { sb: 25, bb: 50, ante: 0 },
                    { sb: 50, bb: 100, ante: 0 },
                    { sb: 75, bb: 150, ante: 0 },
                    { sb: 100, bb: 200, ante: 25 },
                    { sb: 150, bb: 300, ante: 25 },
                    { isBreak: true, breakDuration: 5 },
                    { sb: 200, bb: 400, ante: 50 },
                    { sb: 300, bb: 600, ante: 75 },
                    { sb: 400, bb: 800, ante: 100 },
                    { sb: 500, bb: 1000, ante: 100 },
                    { isBreak: true, breakDuration: 5 },
                    { sb: 600, bb: 1200, ante: 150 },
                    { sb: 800, bb: 1600, ante: 200 },
                    { sb: 1000, bb: 2000, ante: 300 },
                    { sb: 1500, bb: 3000, ante: 400 },
                    { sb: 2000, bb: 4000, ante: 500 }
                ]
            },
            standard: {
                name: 'Standard',
                duration: 20,
                structure: [
                    { sb: 25, bb: 50, ante: 0 },
                    { sb: 50, bb: 100, ante: 0 },
                    { sb: 75, bb: 150, ante: 0 },
                    { sb: 100, bb: 200, ante: 25 },
                    { sb: 150, bb: 300, ante: 25 },
                    { isBreak: true, breakDuration: 10 },
                    { sb: 200, bb: 400, ante: 50 },
                    { sb: 300, bb: 600, ante: 75 },
                    { sb: 400, bb: 800, ante: 100 },
                    { sb: 500, bb: 1000, ante: 100 },
                    { sb: 600, bb: 1200, ante: 150 },
                    { isBreak: true, breakDuration: 15 },
                    { sb: 800, bb: 1600, ante: 200 },
                    { sb: 1000, bb: 2000, ante: 300 },
                    { sb: 1500, bb: 3000, ante: 400 },
                    { sb: 2000, bb: 4000, ante: 500 },
                    { sb: 3000, bb: 6000, ante: 750 }
                ]
            },
            deepstack: {
                name: 'Deep Stack',
                duration: 30,
                structure: [
                    { sb: 25, bb: 50, ante: 0 },
                    { sb: 50, bb: 100, ante: 0 },
                    { sb: 75, bb: 150, ante: 0 },
                    { sb: 100, bb: 200, ante: 0 },
                    { sb: 100, bb: 200, ante: 25 },
                    { isBreak: true, breakDuration: 15 },
                    { sb: 150, bb: 300, ante: 25 },
                    { sb: 200, bb: 400, ante: 50 },
                    { sb: 250, bb: 500, ante: 50 },
                    { sb: 300, bb: 600, ante: 75 },
                    { isBreak: true, breakDuration: 15 },
                    { sb: 400, bb: 800, ante: 100 },
                    { sb: 500, bb: 1000, ante: 100 },
                    { sb: 600, bb: 1200, ante: 150 },
                    { sb: 800, bb: 1600, ante: 200 },
                    { isBreak: true, breakDuration: 20 },
                    { sb: 1000, bb: 2000, ante: 300 },
                    { sb: 1500, bb: 3000, ante: 400 },
                    { sb: 2000, bb: 4000, ante: 500 },
                    { sb: 3000, bb: 6000, ante: 750 }
                ]
            },
            superTurbo: {
                name: 'Super Turbo',
                duration: 5,
                structure: [
                    { sb: 50, bb: 100, ante: 0 },
                    { sb: 100, bb: 200, ante: 25 },
                    { sb: 150, bb: 300, ante: 25 },
                    { sb: 200, bb: 400, ante: 50 },
                    { sb: 300, bb: 600, ante: 75 },
                    { sb: 400, bb: 800, ante: 100 },
                    { sb: 500, bb: 1000, ante: 100 },
                    { sb: 600, bb: 1200, ante: 150 },
                    { sb: 800, bb: 1600, ante: 200 },
                    { sb: 1000, bb: 2000, ante: 300 }
                ]
            },
            shootout: {
                name: 'Shootout',
                duration: 15,
                structure: [
                    { sb: 25, bb: 50, ante: 0 },
                    { sb: 50, bb: 100, ante: 0 },
                    { sb: 100, bb: 200, ante: 0 },
                    { sb: 150, bb: 300, ante: 0 },
                    { sb: 200, bb: 400, ante: 0 },
                    { sb: 300, bb: 600, ante: 0 },
                    { sb: 400, bb: 800, ante: 0 },
                    { sb: 500, bb: 1000, ante: 0 },
                    { sb: 600, bb: 1200, ante: 0 },
                    { sb: 800, bb: 1600, ante: 0 }
                ]
            },
            bounty: {
                name: 'Bounty',
                duration: 15,
                structure: [
                    { sb: 25, bb: 50, ante: 0 },
                    { sb: 50, bb: 100, ante: 0 },
                    { sb: 75, bb: 150, ante: 0 },
                    { sb: 100, bb: 200, ante: 25 },
                    { isBreak: true, breakDuration: 10 },
                    { sb: 150, bb: 300, ante: 50 },
                    { sb: 200, bb: 400, ante: 50 },
                    { sb: 300, bb: 600, ante: 75 },
                    { sb: 400, bb: 800, ante: 100 },
                    { isBreak: true, breakDuration: 10 },
                    { sb: 500, bb: 1000, ante: 100 },
                    { sb: 600, bb: 1200, ante: 150 },
                    { sb: 800, bb: 1600, ante: 200 },
                    { sb: 1000, bb: 2000, ante: 300 }
                ]
            }
        };

        // ===============================
        // AUDIO
        // ===============================
        function initAudio() {
            if (!audioContext) {
                audioContext = new (window.AudioContext || window.webkitAudioContext)();
            }
        }

        function playBeep(frequency = 800, duration = 200, type = 'sine') {
            if (!soundEnabled) return;
            initAudio();

            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();

            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);

            oscillator.frequency.value = frequency;
            oscillator.type = type;

            gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + duration / 1000);

            oscillator.start(audioContext.currentTime);
            oscillator.stop(audioContext.currentTime + duration / 1000);
        }

        function playLevelChangeSound() {
            if (!soundEnabled) return;
            playBeep(600, 150);
            setTimeout(() => playBeep(800, 150), 200);
            setTimeout(() => playBeep(1000, 300), 400);
        }

        function playBreakSound() {
            if (!soundEnabled) return;
            for (let i = 0; i < 3; i++) {
                setTimeout(() => playBeep(500, 200), i * 250);
            }
        }

        function playWarningSound() {
            if (!soundEnabled) return;
            playBeep(400, 150);
        }

        function toggleSound() {
            soundEnabled = !soundEnabled;
            const btn = document.getElementById('soundToggle');
            btn.textContent = soundEnabled ? 'üîä' : 'üîá';
            btn.classList.toggle('muted', !soundEnabled);
            if (soundEnabled) {
                initAudio();
                playBeep(800, 100);
            }
        }

        // ===============================
        // TIME FORMATTING
        // ===============================
        function formatTime(seconds) {
            const mins = Math.floor(seconds / 60);
            const secs = seconds % 60;
            return `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
        }

        function formatTotalTime(seconds) {
            const hrs = Math.floor(seconds / 3600);
            const mins = Math.floor((seconds % 3600) / 60);
            const secs = seconds % 60;
            return `${hrs.toString().padStart(2, '0')}:${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
        }

        // ===============================
        // DISPLAY UPDATES
        // ===============================
        function updateDisplay() {
            const current = structure[currentLevelIndex];
            const countdown = document.getElementById('countdown');

            countdown.textContent = formatTime(timeRemaining);

            // Update warning states
            const warningTime = parseInt(document.getElementById('warningTime')?.value) || 60;
            const dangerTime = parseInt(document.getElementById('dangerTime')?.value) || 10;

            countdown.classList.remove('warning', 'danger');
            if (timeRemaining <= dangerTime) {
                countdown.classList.add('danger');
            } else if (timeRemaining <= warningTime) {
                countdown.classList.add('warning');
            }

            // Update level and blinds display
            if (current.isBreak) {
                document.getElementById('currentLevel').textContent = 'BREAK';
                document.getElementById('blindsText').textContent = 'Take a Break!';
                document.getElementById('anteText').textContent = '';
                document.getElementById('breakBadge').classList.add('active');
            } else {
                document.getElementById('currentLevel').textContent = current.level;
                document.getElementById('blindsText').textContent = `${current.sb.toLocaleString()} / ${current.bb.toLocaleString()}`;
                document.getElementById('anteText').textContent = current.ante > 0 ? `Ante: ${current.ante.toLocaleString()}` : '';
                document.getElementById('breakBadge').classList.remove('active');
            }

            // Update rebuy badge
            const rebuyEndLevel = parseInt(document.getElementById('rebuyEndLevel')?.value) || 6;
            const currentPlayLevel = structure.filter((s, i) => i <= currentLevelIndex && !s.isBreak).length;
            rebuyOpen = currentPlayLevel <= rebuyEndLevel;
            document.getElementById('rebuyBadge').classList.toggle('active', rebuyOpen);

            // Update next level info
            if (currentLevelIndex < structure.length - 1) {
                const next = structure[currentLevelIndex + 1];
                if (next.isBreak) {
                    document.getElementById('nextBlinds').textContent = `BREAK (${next.breakDuration || 10} min)`;
                } else {
                    document.getElementById('nextBlinds').textContent = `${next.sb.toLocaleString()} / ${next.bb.toLocaleString()}`;
                }
                document.getElementById('nextLevelInfo').style.display = 'inline-block';
            } else {
                document.getElementById('nextLevelInfo').style.display = 'none';
            }

            // Update levels remaining
            const levelsLeft = structure.length - currentLevelIndex - 1;
            document.getElementById('levelsRemaining').textContent = levelsLeft;

            updateStats();
            renderStructure();
        }

        function updateStats() {
            document.getElementById('totalTime').textContent = formatTotalTime(totalSeconds);

            const startingChips = parseInt(document.getElementById('startingChips')?.value) || 10000;
            const current = structure[currentLevelIndex];

            // Update player/table info
            document.getElementById('playersRemaining').textContent = playersRemaining;

            const seatsPerTable = parseInt(document.getElementById('seatsPerTable')?.value) || 9;
            const tables = Math.ceil(playersRemaining / seatsPerTable);
            const perTable = playersRemaining > 0 ? Math.round(playersRemaining / tables * 10) / 10 : 0;

            document.getElementById('tablesCount').textContent = tables;
            document.getElementById('playersPerTable').textContent = perTable.toFixed(1);

            const totalChips = startingChips * (parseInt(document.getElementById('playerCount')?.value) || 9) + (rebuys * startingChips);
            document.getElementById('totalChips').textContent = totalChips.toLocaleString();

            if (!current.isBreak && current.bb > 0) {
                const avgStack = Math.round(totalChips / playersRemaining);
                const avgBB = Math.round(avgStack / current.bb);
                document.getElementById('avgStack').textContent = avgBB;

                // M-Ratio calculation
                const pot = current.sb + current.bb + (current.ante * seatsPerTable);
                const mRatio = Math.round(avgStack / pot);
                document.getElementById('mRatio').textContent = mRatio;
            }

            updatePrizePool();
            updateChipLegend();
        }

        function updatePrizePool() {
            const buyIn = parseFloat(document.getElementById('buyIn')?.value) || 0;
            const rebuyAmount = parseFloat(document.getElementById('rebuyAmount')?.value) || 0;
            const playerCount = parseInt(document.getElementById('playerCount')?.value) || 9;

            const total = (buyIn * playerCount) + (rebuyAmount * rebuys);
            document.getElementById('prizePool').textContent = `$${total.toLocaleString()}`;

            // Update payouts
            const payout1 = parseInt(document.getElementById('payout1')?.value) || 50;
            const payout2 = parseInt(document.getElementById('payout2')?.value) || 30;
            const payout3 = parseInt(document.getElementById('payout3')?.value) || 20;

            const prizeList = document.getElementById('prizeList');
            prizeList.innerHTML = `
                <div class="prize-item"><span class="prize-place">1st</span><span class="prize-amount">$${Math.round(total * payout1 / 100).toLocaleString()}</span></div>
                <div class="prize-item"><span class="prize-place">2nd</span><span class="prize-amount">$${Math.round(total * payout2 / 100).toLocaleString()}</span></div>
                <div class="prize-item"><span class="prize-place">3rd</span><span class="prize-amount">$${Math.round(total * payout3 / 100).toLocaleString()}</span></div>
            `;
        }

        function updateChipLegend() {
            const legend = document.getElementById('chipLegend');
            legend.innerHTML = chips.filter(chip => chip.active !== false).map(chip => `
                <div class="chip">
                    <div class="chip-color" style="background: ${chip.color}"></div>
                    <span>${chip.value.toLocaleString()}</span>
                </div>
            `).join('');
        }

        function renderChipSettings() {
            const container = document.getElementById('chipSettings');
            container.innerHTML = chips.map((chip, index) => `
                <div class="chip-setting-row ${chip.active === false ? 'inactive' : ''}">
                    <input type="checkbox" ${chip.active !== false ? 'checked' : ''} onchange="updateChipFromSettings(${index}, 'active', this.checked)" title="Active">
                    <input type="color" value="${chip.color}" onchange="updateChipFromSettings(${index}, 'color', this.value)" title="Chip color">
                    <label>Value</label>
                    <input type="number" value="${chip.value}" min="1" onchange="updateChipFromSettings(${index}, 'value', parseInt(this.value))" title="Chip value">
                    <label>Name</label>
                    <input type="text" value="${chip.name}" onchange="updateChipFromSettings(${index}, 'name', this.value)" title="Chip name">
                    <button class="chip-remove-btn" onclick="removeChip(${index})" title="Remove chip">√ó</button>
                </div>
            `).join('');
        }

        function updateChipFromSettings(index, field, value) {
            chips[index][field] = value;
            if (field === 'active') {
                renderChipSettings();
            }
            updateChipLegend();
            saveSettings();
        }

        function addChip() {
            const colors = ['#ffffff', '#3498db', '#e74c3c', '#2ecc71', '#000000', '#f39c12', '#9b59b6', '#1abc9c'];
            const lastValue = chips.length > 0 ? chips[chips.length - 1].value : 0;
            chips.push({
                value: lastValue * 2 || 100,
                color: colors[chips.length % colors.length],
                name: 'Custom',
                active: true
            });
            renderChipSettings();
            updateChipLegend();
            saveSettings();
        }

        function removeChip(index) {
            if (chips.length <= 1) return;
            chips.splice(index, 1);
            renderChipSettings();
            updateChipLegend();
            saveSettings();
        }

        function resetChipsToDefault() {
            chips = defaultChips.map(chip => ({...chip}));
            renderChipSettings();
            updateChipLegend();
            saveSettings();
        }

        // ===============================
        // TIMER CONTROLS
        // ===============================
        function toggleTimer() {
            if (isRunning) {
                pauseTimer();
            } else {
                startTimer();
            }
        }

        function startTimer() {
            if (isRunning) return;

            initAudio();
            isRunning = true;
            document.getElementById('playPauseBtn').textContent = 'PAUSE';

            timerInterval = setInterval(() => {
                timeRemaining--;

                // Play warning sounds
                const warningTime = parseInt(document.getElementById('warningTime')?.value) || 60;
                const playCountdown = document.getElementById('playCountdown')?.checked !== false;

                if (timeRemaining === warningTime || timeRemaining === 30) {
                    playWarningSound();
                }

                // Countdown beeps
                if (playCountdown && timeRemaining <= 5 && timeRemaining > 0) {
                    playBeep(600, 100);
                }

                if (timeRemaining <= 0) {
                    const autoAdvance = document.getElementById('autoAdvance')?.checked !== false;
                    if (autoAdvance) {
                        advanceLevel();
                    } else {
                        timeRemaining = 0;
                        pauseTimer();
                        showAnnouncement('Time!', 'Level time has ended. Click to advance.');
                    }
                }

                updateDisplay();
            }, 1000);

            totalTimeInterval = setInterval(() => {
                totalSeconds++;
                document.getElementById('totalTime').textContent = formatTotalTime(totalSeconds);
            }, 1000);
        }

        function pauseTimer() {
            isRunning = false;
            document.getElementById('playPauseBtn').textContent = 'START';
            clearInterval(timerInterval);
            clearInterval(totalTimeInterval);
        }

        function resetLevel() {
            const current = structure[currentLevelIndex];
            if (current.isBreak) {
                timeRemaining = (current.breakDuration || 10) * 60;
            } else {
                timeRemaining = current.duration ? current.duration * 60 : levelDuration;
            }
            updateDisplay();
        }

        function adjustTime(seconds) {
            timeRemaining = Math.max(0, timeRemaining + seconds);
            updateDisplay();
        }

        function advanceLevel() {
            if (currentLevelIndex < structure.length - 1) {
                currentLevelIndex++;
                const current = structure[currentLevelIndex];

                if (current.isBreak) {
                    timeRemaining = (current.breakDuration || 10) * 60;
                    if (document.getElementById('announceBreaks')?.checked !== false) {
                        playBreakSound();
                        showAnnouncement('Break Time!', `Take a ${current.breakDuration || 10} minute break`);
                    }
                } else {
                    timeRemaining = current.duration ? current.duration * 60 : levelDuration;
                    if (document.getElementById('announceLevels')?.checked !== false) {
                        playLevelChangeSound();
                        showAnnouncement('Level Up!', `Blinds: ${current.sb.toLocaleString()} / ${current.bb.toLocaleString()}${current.ante > 0 ? ` | Ante: ${current.ante.toLocaleString()}` : ''}`);
                    }
                }

                updateDisplay();
            } else {
                pauseTimer();
                showAnnouncement('Tournament Complete!', 'All levels have been played.');
            }
        }

        function previousLevel() {
            if (currentLevelIndex > 0) {
                currentLevelIndex--;
                resetLevel();
            }
        }

        function nextLevel() {
            if (currentLevelIndex < structure.length - 1) {
                currentLevelIndex++;
                resetLevel();
            }
        }

        function jumpToLevel(levelNum) {
            let count = 0;
            for (let i = 0; i < structure.length; i++) {
                if (!structure[i].isBreak) {
                    count++;
                    if (count === levelNum) {
                        currentLevelIndex = i;
                        resetLevel();
                        return;
                    }
                }
            }
        }

        // ===============================
        // PLAYER MANAGEMENT
        // ===============================
        function adjustPlayers(delta) {
            playersRemaining = Math.max(1, playersRemaining + delta);
            updateStats();
        }

        // ===============================
        // SPECIAL MODES
        // ===============================
        function toggleRebuy() {
            rebuys++;
            updateStats();
            showAnnouncement('Rebuy!', `Total rebuys: ${rebuys}`);
        }

        function toggleHandForHand() {
            handForHand = !handForHand;
            document.getElementById('hfhBadge').classList.toggle('active', handForHand);
            if (handForHand) {
                showAnnouncement('Hand for Hand', 'Tournament is now hand-for-hand');
            }
        }

        function toggleBubble() {
            bubbleMode = !bubbleMode;
            document.getElementById('bubbleBadge').classList.toggle('active', bubbleMode);
        }

        function randomSeat() {
            const tables = Math.ceil(playersRemaining / (parseInt(document.getElementById('seatsPerTable')?.value) || 9));
            const seats = parseInt(document.getElementById('seatsPerTable')?.value) || 9;

            const table = Math.floor(Math.random() * tables) + 1;
            const seat = Math.floor(Math.random() * seats) + 1;

            document.getElementById('randomTable').textContent = table;
            document.getElementById('randomSeat').textContent = seat;
            document.getElementById('randomSeatResult').textContent = `Table ${table}, Seat ${seat}`;
            document.getElementById('randomSeatModal').classList.add('active');
        }

        // ===============================
        // PRESENTATION MODE
        // ===============================
        function togglePresentation() {
            presentationMode = !presentationMode;
            const timerDisplay = document.getElementById('timerDisplay');
            const sidePanel = document.getElementById('sidePanel');
            const exitBtn = document.getElementById('exitPresentationBtn');

            timerDisplay.classList.toggle('presentation-mode', presentationMode);
            sidePanel.hidden = presentationMode;
            exitBtn.hidden = !presentationMode;

            document.getElementById('presentationBtn').classList.toggle('active', presentationMode);
        }

        function exitPresentation() {
            presentationMode = false;
            document.getElementById('timerDisplay').classList.remove('presentation-mode');
            document.getElementById('sidePanel').hidden = false;
            document.getElementById('exitPresentationBtn').hidden = true;
            document.getElementById('presentationBtn').classList.remove('active');
        }

        function toggleFullscreen() {
            if (!document.fullscreenElement) {
                document.documentElement.requestFullscreen();
            } else {
                document.exitFullscreen();
            }
        }

        // ===============================
        // STRUCTURE MANAGEMENT
        // ===============================
        function updateLevelDuration() {
            const mins = parseInt(document.getElementById('levelDuration').value) || 20;
            levelDuration = mins * 60;
            if (!isRunning && structure[currentLevelIndex] && !structure[currentLevelIndex].isBreak) {
                if (!structure[currentLevelIndex].duration) {
                    timeRemaining = levelDuration;
                    updateDisplay();
                }
            }
        }

        function renderStructure() {
            const tbody = document.getElementById('structureBody');
            tbody.innerHTML = '';

            let levelNum = 0;
            structure.forEach((item, index) => {
                const row = document.createElement('tr');

                if (item.isBreak) {
                    row.className = 'break-row';
                    if (index === currentLevelIndex) row.classList.add('current-level');
                    row.innerHTML = `
                        <td colspan="4" style="cursor: pointer;" onclick="currentLevelIndex=${index}; resetLevel();">BREAK</td>
                        <td><input type="number" value="${item.breakDuration || 10}" min="1" style="width: 60px;" onchange="updateStructureField(${index}, 'breakDuration', this.value)"> min</td>
                        <td><button class="remove-btn" onclick="removeLevel(${index})">‚úï</button></td>
                    `;
                } else {
                    levelNum++;
                    if (index === currentLevelIndex) row.classList.add('current-level');
                    row.innerHTML = `
                        <td style="cursor: pointer;" onclick="currentLevelIndex=${index}; resetLevel();">${levelNum}</td>
                        <td><input type="number" value="${item.sb}" onchange="updateStructureField(${index}, 'sb', this.value)"></td>
                        <td><input type="number" value="${item.bb}" onchange="updateStructureField(${index}, 'bb', this.value)"></td>
                        <td><input type="number" value="${item.ante}" onchange="updateStructureField(${index}, 'ante', this.value)"></td>
                        <td><input type="number" value="${item.duration || levelDuration / 60}" min="1" style="width: 60px;" onchange="updateStructureField(${index}, 'duration', this.value)"> min</td>
                        <td><button class="remove-btn" onclick="removeLevel(${index})">‚úï</button></td>
                    `;
                }

                tbody.appendChild(row);
            });
        }

        function updateStructureField(index, field, value) {
            structure[index][field] = parseInt(value) || 0;
            if (index === currentLevelIndex) {
                if (field === 'duration' || field === 'breakDuration') {
                    resetLevel();
                }
                updateDisplay();
            }
            renumberLevels();
            saveState();
        }

        function addLevel() {
            const lastLevel = structure.filter(s => !s.isBreak).pop();
            const newSb = lastLevel ? lastLevel.bb : 25;
            const newBb = newSb * 2;
            const newAnte = lastLevel && lastLevel.ante > 0 ? Math.round(newBb * 0.125) : 0;

            structure.push({
                level: 0,
                sb: newSb,
                bb: newBb,
                ante: newAnte,
                isBreak: false,
                duration: levelDuration / 60
            });

            renumberLevels();
            renderStructure();
            saveState();
        }

        function addBreak() {
            structure.push({
                level: 0,
                sb: 0,
                bb: 0,
                ante: 0,
                isBreak: true,
                breakDuration: 10
            });
            renderStructure();
            saveState();
        }

        function removeLevel(index) {
            if (structure.length > 1) {
                if (index < currentLevelIndex) {
                    currentLevelIndex--;
                } else if (index === currentLevelIndex && currentLevelIndex >= structure.length - 1) {
                    currentLevelIndex = structure.length - 2;
                }
                structure.splice(index, 1);
                renumberLevels();
                updateDisplay();
                saveState();
            }
        }

        function renumberLevels() {
            let num = 1;
            structure.forEach(item => {
                if (!item.isBreak) {
                    item.level = num++;
                }
            });
        }

        // ===============================
        // PRESETS & IMPORT/EXPORT
        // ===============================
        function loadPreset(presetName) {
            const preset = presets[presetName];
            if (!preset) return;

            structure = [];
            let levelNum = 1;

            preset.structure.forEach(item => {
                if (item.isBreak) {
                    structure.push({ ...item, level: 0 });
                } else {
                    structure.push({
                        level: levelNum++,
                        sb: item.sb,
                        bb: item.bb,
                        ante: item.ante,
                        isBreak: false,
                        duration: preset.duration
                    });
                }
            });

            levelDuration = preset.duration * 60;
            document.getElementById('levelDuration').value = preset.duration;
            currentLevelIndex = 0;
            resetLevel();
            saveState();

            showAnnouncement('Preset Loaded', `${preset.name} tournament structure loaded`);
        }

        function exportStructure() {
            const data = {
                name: document.getElementById('tournamentName').value,
                levelDuration: levelDuration / 60,
                startingChips: parseInt(document.getElementById('startingChips').value),
                structure: structure
            };

            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `poker-structure-${Date.now()}.json`;
            a.click();
            URL.revokeObjectURL(url);
        }

        function importStructure() {
            document.getElementById('importModal').classList.add('active');
        }

        function doImport() {
            try {
                const data = JSON.parse(document.getElementById('importData').value);
                if (data.structure && Array.isArray(data.structure)) {
                    structure = data.structure;
                    renumberLevels();

                    if (data.levelDuration) {
                        levelDuration = data.levelDuration * 60;
                        document.getElementById('levelDuration').value = data.levelDuration;
                    }
                    if (data.startingChips) {
                        document.getElementById('startingChips').value = data.startingChips;
                    }
                    if (data.name) {
                        document.getElementById('tournamentName').value = data.name;
                    }

                    currentLevelIndex = 0;
                    resetLevel();
                    closeModal('importModal');
                    saveState();
                    showAnnouncement('Import Successful', 'Structure loaded successfully');
                }
            } catch (e) {
                alert('Invalid JSON format');
            }
        }

        function saveTournament() {
            const name = prompt('Enter tournament name:', document.getElementById('tournamentName').value);
            if (!name) return;

            const saved = JSON.parse(localStorage.getItem('savedTournaments') || '[]');
            saved.push({
                name,
                date: new Date().toISOString(),
                data: {
                    structure,
                    levelDuration: levelDuration / 60,
                    startingChips: parseInt(document.getElementById('startingChips').value),
                    settings: getSettings()
                }
            });
            localStorage.setItem('savedTournaments', JSON.stringify(saved));
            renderSavedTournaments();
        }

        function renderSavedTournaments() {
            const saved = JSON.parse(localStorage.getItem('savedTournaments') || '[]');
            const container = document.getElementById('savedTournaments');

            if (saved.length === 0) {
                container.innerHTML = '<p style="color: #888; font-size: 0.9rem;">No saved tournaments</p>';
                return;
            }

            container.innerHTML = saved.map((t, i) => `
                <div style="display: flex; justify-content: space-between; align-items: center; padding: 8px; background: rgba(45, 90, 61, 0.2); border-radius: 5px; margin-bottom: 5px;">
                    <span>${t.name}</span>
                    <div>
                        <button class="preset-btn" onclick="loadSavedTournament(${i})">Load</button>
                        <button class="remove-btn" onclick="deleteSavedTournament(${i})">‚úï</button>
                    </div>
                </div>
            `).join('');
        }

        function loadSavedTournament(index) {
            const saved = JSON.parse(localStorage.getItem('savedTournaments') || '[]');
            if (!saved[index]) return;

            const t = saved[index].data;
            structure = t.structure;
            levelDuration = t.levelDuration * 60;
            document.getElementById('levelDuration').value = t.levelDuration;
            document.getElementById('startingChips').value = t.startingChips;

            if (t.settings) {
                Object.entries(t.settings).forEach(([key, value]) => {
                    const el = document.getElementById(key);
                    if (el) {
                        if (el.type === 'checkbox') el.checked = value;
                        else el.value = value;
                    }
                });
            }

            currentLevelIndex = 0;
            renumberLevels();
            resetLevel();
            showAnnouncement('Tournament Loaded', saved[index].name);
        }

        function deleteSavedTournament(index) {
            if (!confirm('Delete this tournament?')) return;
            const saved = JSON.parse(localStorage.getItem('savedTournaments') || '[]');
            saved.splice(index, 1);
            localStorage.setItem('savedTournaments', JSON.stringify(saved));
            renderSavedTournaments();
        }

        // ===============================
        // SETTINGS
        // ===============================
        function getSettings() {
            return {
                tournamentName: document.getElementById('tournamentName')?.value,
                startingChips: document.getElementById('startingChips')?.value,
                playerCount: document.getElementById('playerCount')?.value,
                buyIn: document.getElementById('buyIn')?.value,
                rebuyAmount: document.getElementById('rebuyAmount')?.value,
                seatsPerTable: document.getElementById('seatsPerTable')?.value,
                rebuyEndLevel: document.getElementById('rebuyEndLevel')?.value,
                warningTime: document.getElementById('warningTime')?.value,
                dangerTime: document.getElementById('dangerTime')?.value,
                announceLevels: document.getElementById('announceLevels')?.checked,
                announceBreaks: document.getElementById('announceBreaks')?.checked,
                playCountdown: document.getElementById('playCountdown')?.checked,
                autoAdvance: document.getElementById('autoAdvance')?.checked,
                payout1: document.getElementById('payout1')?.value,
                payout2: document.getElementById('payout2')?.value,
                payout3: document.getElementById('payout3')?.value
            };
        }

        function saveSettings() {
            saveState();
        }

        // ===============================
        // TABS
        // ===============================
        function switchTab(tabName) {
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));

            document.querySelector(`.tab[onclick="switchTab('${tabName}')"]`).classList.add('active');
            document.getElementById(`${tabName}Tab`).classList.add('active');
        }

        // ===============================
        // MODALS & ANNOUNCEMENTS
        // ===============================
        function showAnnouncement(title, text) {
            document.getElementById('announcementTitle').textContent = title;
            document.getElementById('announcementText').textContent = text;
            document.getElementById('announcement').classList.add('active');
        }

        function closeAnnouncement() {
            document.getElementById('announcement').classList.remove('active');
        }

        function closeModal(modalId) {
            document.getElementById(modalId).classList.remove('active');
        }

        // ===============================
        // STATE PERSISTENCE
        // ===============================
        function saveState() {
            localStorage.setItem('pokerTimer', JSON.stringify({
                structure,
                currentLevelIndex,
                timeRemaining,
                totalSeconds,
                levelDuration,
                playersRemaining,
                rebuys,
                theme: currentTheme,
                chips: chips,
                settings: getSettings()
            }));
        }

        function loadState() {
            const saved = localStorage.getItem('pokerTimer');
            if (saved) {
                try {
                    const state = JSON.parse(saved);
                    structure = state.structure || getDefaultStructure();
                    currentLevelIndex = state.currentLevelIndex || 0;
                    timeRemaining = state.timeRemaining || levelDuration;
                    totalSeconds = state.totalSeconds || 0;
                    levelDuration = state.levelDuration || 20 * 60;
                    playersRemaining = state.playersRemaining || 9;
                    rebuys = state.rebuys || 0;

                    document.getElementById('levelDuration').value = levelDuration / 60;

                    if (state.settings) {
                        Object.entries(state.settings).forEach(([key, value]) => {
                            const el = document.getElementById(key);
                            if (el) {
                                if (el.type === 'checkbox') el.checked = value;
                                else el.value = value;
                            }
                        });
                    }

                    // Load theme
                    if (state.theme) {
                        setTheme(state.theme);
                    }

                    // Load chips
                    if (state.chips && state.chips.length > 0) {
                        chips = state.chips;
                    }
                } catch (e) {
                    console.log('Could not restore saved state');
                    loadPreset('standard');
                }
            } else {
                loadPreset('standard');
            }
        }

        function getDefaultStructure() {
            return presets.standard.structure.map((item, i) => ({
                ...item,
                level: item.isBreak ? 0 : i + 1,
                duration: 20
            }));
        }

        // ===============================
        // EVENT LISTENERS
        // ===============================
        document.getElementById('soundToggle').addEventListener('click', toggleSound);
        document.getElementById('presentationBtn').addEventListener('click', togglePresentation);
        document.getElementById('fullscreenBtn').addEventListener('click', toggleFullscreen);
        document.getElementById('helpBtn').addEventListener('click', () => document.getElementById('helpModal').classList.add('active'));

        // Keyboard shortcuts
        document.addEventListener('keydown', (e) => {
            if (e.target.tagName === 'INPUT' || e.target.tagName === 'TEXTAREA') return;

            switch(e.code) {
                case 'Space':
                    e.preventDefault();
                    toggleTimer();
                    break;
                case 'ArrowLeft':
                    previousLevel();
                    break;
                case 'ArrowRight':
                    nextLevel();
                    break;
                case 'KeyR':
                    resetLevel();
                    break;
                case 'KeyF':
                    toggleFullscreen();
                    break;
                case 'KeyP':
                    togglePresentation();
                    break;
                case 'KeyM':
                    toggleSound();
                    break;
                case 'KeyH':
                    toggleHandForHand();
                    break;
                case 'KeyB':
                    toggleBubble();
                    break;
                case 'Equal':
                case 'NumpadAdd':
                    adjustTime(60);
                    break;
                case 'Minus':
                case 'NumpadSubtract':
                    adjustTime(-60);
                    break;
                case 'Digit1': case 'Digit2': case 'Digit3': case 'Digit4':
                case 'Digit5': case 'Digit6': case 'Digit7': case 'Digit8': case 'Digit9':
                    jumpToLevel(parseInt(e.code.replace('Digit', '')));
                    break;
                case 'Escape':
                    if (presentationMode) exitPresentation();
                    closeAnnouncement();
                    document.querySelectorAll('.modal-overlay').forEach(m => m.classList.remove('active'));
                    break;
            }
        });

        // Auto-save on state changes
        window.addEventListener('beforeunload', saveState);
        setInterval(saveState, 30000); // Auto-save every 30 seconds

        // ===============================
        // INITIALIZATION
        // ===============================
        loadState();
        updateDisplay();
        renderChipSettings();
        renderSavedTournaments();
    </script>
</body>
</html>
